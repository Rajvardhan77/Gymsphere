{% extends "base.html" %}

{% block title %}Shop | GymSphere{% endblock %}

{% block content %}
<div class="space-y-6">
    <div class="flex items-center justify-between">
        <h1 class="text-2xl font-bold text-white">Gear & Fuel</h1>
        <div class="text-sm text-cyan-400">Recommended for You</div>
    </div>

    <!-- Smart Recommendation Banner -->
    <div class="glass-premium rounded-xl p-6 relative overflow-hidden group">
        <div class="absolute inset-0 bg-gradient-to-r from-purple-900/40 to-cyan-900/40 opacity-50"></div>
        <div class="relative z-10">
            <h2 class="text-lg font-bold text-white mb-2">Goal: {{ user.goal|replace('_', ' ')|title }}</h2>
            <p class="text-sm text-gray-300 max-w-lg mb-4">
                We've curated this selection to help you reach your specific fitness targets faster.
                From supplements to equipment, these are your essentials.
            </p>
        </div>
        <div class="text-6xl absolute top-4 right-4 opacity-20 rotate-12">üõçÔ∏è</div>
    </div>

    <!-- Product Grid -->
    <div id="shopGrid" class="grid grid-cols-2 md:grid-cols-3 gap-4">
        <!-- Loaded via JS -->
        <div class="col-span-full py-12 flex justify-center">
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-cyan-400"></div>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        fetch('/api/shop/recommend')
            .then(r => r.json())
            .then(data => {
                const grid = document.getElementById('shopGrid');
                grid.innerHTML = '';

                if (data.length === 0) {
                    grid.innerHTML = '<div class="col-span-full text-center text-gray-500 italic">No products found.</div>';
                    return;
                }

                data.forEach(item => {
                    const card = `
                <div class="glass-premium rounded-xl overflow-hidden group relative flex flex-col">
                     <div class="h-40 overflow-hidden relative bg-black/50">
                        <img src="${item.image_url}" alt="${item.name}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500">
                        <div class="absolute top-2 right-2 bg-black/60 text-yellow-400 text-[10px] font-bold px-2 py-1 rounded backdrop-blur-md">
                            ‚òÖ ${item.rating}
                        </div>
                     </div>
                     <div class="p-4 flex-1 flex flex-col">
                        <div class="text-sm font-bold text-white mb-1 leading-tight">${item.name}</div>
                        <div class="text-xs text-gray-400 mb-4 flex-1">${item.src === 'amazon' ? 'Amazon Choice' : 'Store Pickup'}</div>
                        
                        <div class="flex items-center justify-between mt-auto">
                            <span class="text-cyan-300 font-bold">$${item.price}</span>
                            <a href="${item.affiliate_url}" target="_blank" class="bg-white/10 hover:bg-cyan-500 text-cyan-400 hover:text-white text-xs font-bold px-3 py-1.5 rounded-lg transition-colors">
                                Buy Now
                            </a>
                        </div>
                     </div>
                </div>
                `;
                    grid.innerHTML += card;
                });
            });
    });
</script>
{% endblock %}